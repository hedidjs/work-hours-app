{"version":3,"sources":["../../../../src/utils/calculations.ts"],"sourcesContent":["import type { Employer } from '../types';\n\nexport function calculateHours(startTime: string, endTime: string): { totalHours: number; regularHours: number; overtimeHours: number } {\n  const [startH, startM] = startTime.split(':').map(Number);\n  const [endH, endM] = endTime.split(':').map(Number);\n\n  let startMinutes = startH * 60 + startM;\n  let endMinutes = endH * 60 + endM;\n\n  // אם שעת הסיום קטנה משעת ההתחלה, זה אומר שעברנו יום\n  if (endMinutes < startMinutes) {\n    endMinutes += 24 * 60;\n  }\n\n  const totalMinutes = endMinutes - startMinutes;\n  const totalHours = totalMinutes / 60;\n\n  const regularHours = Math.min(totalHours, 12);\n  const overtimeHours = Math.max(0, totalHours - 12);\n\n  return {\n    totalHours: Math.round(totalHours * 100) / 100,\n    regularHours: Math.round(regularHours * 100) / 100,\n    overtimeHours: Math.round(overtimeHours * 100) / 100\n  };\n}\n\nexport function calculatePayment(\n  regularHours: number,\n  overtimeHours: number,\n  kilometers: number,\n  employer: Employer,\n  selectedBonuses: string[] = [],\n  customDailyRate?: number\n): { totalBeforeVat: number; totalWithVat: number; bonusesTotal: number } {\n  // יומית עבודה (אם עבד לפחות שעה אחת, מקבל יומית מלאה)\n  // אם יש מחיר יומית מותאם, משתמשים בו, אחרת לוקחים מהמעסיק\n  const dailyRate = customDailyRate !== undefined ? customDailyRate : employer.dailyRate;\n  const dailyPay = regularHours > 0 ? dailyRate : 0;\n\n  // שעות נוספות\n  const overtimePay = overtimeHours * employer.overtimeRate;\n\n  // נסיעות\n  const kmPay = kilometers * employer.kmRate;\n\n  // תוספות\n  const bonusesTotal = (employer.bonuses || [])\n    .filter(b => selectedBonuses.includes(b.id))\n    .reduce((sum, b) => sum + b.amount, 0);\n\n  const totalBeforeVat = dailyPay + overtimePay + kmPay + bonusesTotal;\n  const totalWithVat = totalBeforeVat * (1 + employer.vatPercent / 100);\n\n  return {\n    totalBeforeVat: Math.round(totalBeforeVat * 100) / 100,\n    totalWithVat: Math.round(totalWithVat * 100) / 100,\n    bonusesTotal: Math.round(bonusesTotal * 100) / 100\n  };\n}\n\nexport function formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('he-IL', {\n    style: 'currency',\n    currency: 'ILS'\n  }).format(amount);\n}\n\nexport function formatDate(dateString: string): string {\n  const date = new Date(dateString);\n  return new Intl.DateTimeFormat('he-IL', {\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric'\n  }).format(date);\n}\n\nexport function formatHours(hours: number): string {\n  const h = Math.floor(hours);\n  const m = Math.round((hours - h) * 60);\n  return `${h}:${m.toString().padStart(2, '0')}`;\n}\n\n// חישוב שעות עם תמיכה במספר נקודות עבודה\nexport interface SegmentForCalc {\n  startTime: string;\n  endTime: string;\n  customDailyRate?: number;\n  selectedBonuses?: string[];\n}\n\nexport function calculateMultiSegmentHours(\n  segments: SegmentForCalc[],\n  _mode: 'combined' | 'separate'\n): { totalHours: number; regularHours: number; overtimeHours: number } {\n  if (segments.length === 0) {\n    return { totalHours: 0, regularHours: 0, overtimeHours: 0 };\n  }\n\n  // תמיד מחשבים את סכום השעות בפועל מכל הנקודות\n  // ההבדל בין \"ביחד\" ל\"בנפרד\" הוא רק במספר היומיות, לא בחישוב השעות\n  let totalHours = 0;\n\n  for (const segment of segments) {\n    const hours = calculateHours(segment.startTime, segment.endTime);\n    totalHours += hours.totalHours;\n  }\n\n  const regularHours = Math.min(totalHours, 12);\n  const overtimeHours = Math.max(0, totalHours - 12);\n\n  return {\n    totalHours: Math.round(totalHours * 100) / 100,\n    regularHours: Math.round(regularHours * 100) / 100,\n    overtimeHours: Math.round(overtimeHours * 100) / 100\n  };\n}\n\n// חישוב תשלום עם תמיכה במספר נקודות עבודה\nexport function calculateMultiSegmentPayment(\n  segments: SegmentForCalc[],\n  mode: 'combined' | 'separate',\n  kilometers: number,\n  employer: Employer\n): { totalBeforeVat: number; totalWithVat: number; bonusesTotal: number; regularHours: number; overtimeHours: number } {\n  if (segments.length === 0) {\n    return { totalBeforeVat: 0, totalWithVat: 0, bonusesTotal: 0, regularHours: 0, overtimeHours: 0 };\n  }\n\n  const hours = calculateMultiSegmentHours(segments, mode);\n\n  let dailyPay = 0;\n\n  if (mode === 'separate') {\n    // בחישוב נפרד: כל נקודה עם יומית משלה\n    for (const segment of segments) {\n      const segmentHours = calculateHours(segment.startTime, segment.endTime);\n      if (segmentHours.totalHours > 0) {\n        const rate = segment.customDailyRate !== undefined ? segment.customDailyRate : employer.dailyRate;\n        dailyPay += rate;\n      }\n    }\n  } else {\n    // בחישוב ביחד: יומית אחת (עם מחיר מותאם אם יש בנקודה הראשונה)\n    if (hours.regularHours > 0) {\n      const customRate = segments[0]?.customDailyRate;\n      dailyPay = customRate !== undefined ? customRate : employer.dailyRate;\n    }\n  }\n\n  // שעות נוספות\n  const overtimePay = hours.overtimeHours * employer.overtimeRate;\n\n  // נסיעות\n  const kmPay = kilometers * employer.kmRate;\n\n  // תוספות - איסוף מכל הנקודות\n  let bonusesTotal = 0;\n  for (const segment of segments) {\n    const segmentBonuses = segment.selectedBonuses || [];\n    const segmentBonusAmount = (employer.bonuses || [])\n      .filter(b => segmentBonuses.includes(b.id))\n      .reduce((sum, b) => sum + b.amount, 0);\n    bonusesTotal += segmentBonusAmount;\n  }\n\n  const totalBeforeVat = dailyPay + overtimePay + kmPay + bonusesTotal;\n  const totalWithVat = totalBeforeVat * (1 + employer.vatPercent / 100);\n\n  return {\n    totalBeforeVat: Math.round(totalBeforeVat * 100) / 100,\n    totalWithVat: Math.round(totalWithVat * 100) / 100,\n    bonusesTotal: Math.round(bonusesTotal * 100) / 100,\n    regularHours: hours.regularHours,\n    overtimeHours: hours.overtimeHours\n  };\n}\n"],"names":[],"mappings":"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"}